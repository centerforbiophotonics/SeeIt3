<!--
   accelTest.html
   
   Author: Matthew Steinwachs   
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"> 
	<meta name="viewport" content="user-scalable=no, width=device-width" />

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0b2/jquery.mobile-1.0b2.min.css" />

	<script type="text/javascript" src = "http://code.jquery.com/jquery-1.6.2.min.js"></script>
	<script type="text/javascript" src = "http://code.jquery.com/mobile/1.0b2/jquery.mobile-1.0b2.min.js"></script>
	<script src="lib/d3.v2.min.js"></script>

	<script type="text/javascript">
		var svg;
		var w, h;
		var laser = [{"xPos" : 0,
									"yPos" : 0,
									"xVel" : 0,
									"yVel" : 0,
									"rad" : 10
								}];
								
		var circle;
		
		$(document).ready(function(){
			
			w = window.innerWidth;
			h = window.innerHeight;
			laser[0].xPos = window.innerWidth/2-10;
			laser[0].yPos = window.innerHeight/2-10;
			
			
			svg = d3.select("#body").append("svg:svg")
				.attr("width", w)
				.attr("height", h);
			
			circle = svg.selectAll("circle")
					.data(laser)
				.enter().append("svg:circle")
					.attr("r", function(d) { return d.rad; })
					.attr("cx", function(d) { return d.xPos; })
					.attr("cy", function(d) { return d.yPos; })
					.style("fill", "red");
			
			window.addEventListener("devicemotion",onDeviceMotion,false);
			
			d3.timer(function(){
				laser[0].xPos += laser[0].xVel;
				laser[0].yPos += laser[0].yVel;
				
				circle.transition()
					.attr("cx", function(d) { return d.xPos; })
					.attr("cy", function(d) { return d.yPos; })
			});
			
		});
		
		
									 
		function onDeviceMotion(event){
			var accel = event.accelerationIncludingGravity;
			var l = laser[0];
			l.xVel += accel.x;
			l.yVel += accel.y;
//			l.xPos += accel.x*10;
//			if (l.xPos < l.rad) l.xPos = l.rad;
//			if (l.xPos > w - l.rad) l.xPos = w - l.rad;
//			
//			l.yPos -= accel.y*10;
//			if (l.yPos < l.rad) l.yPos = l.rad;
//			if (l.yPos > h - l.rad) l.yPos = h - l.rad;
			
//			circle.transition()
//				.attr("cx", function(d) { return d.xPos; })
//				.attr("cy", function(d) { return d.yPos; })
				
		}
	</script>
	
</head> 

<body>
	<div id="body"></div>
	
	
</body>

</html>
