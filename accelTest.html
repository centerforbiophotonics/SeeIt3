<!--
   accelTest.html
   
   Author: Matthew Steinwachs   
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"> 
	<meta name="viewport" content="user-scalable=no, width=device-width" />

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0b2/jquery.mobile-1.0b2.min.css" />

	<script type="text/javascript" src = "http://code.jquery.com/jquery-1.6.2.min.js"></script>
	<script type="text/javascript" src = "http://code.jquery.com/mobile/1.0b2/jquery.mobile-1.0b2.min.js"></script>
	<script src="lib/d3.v2.min.js"></script>

	<script type="text/javascript">
		var svg;
		var w, h;
		var laser = [{"xPos" : 0,
									"yPos" : 0,
									"xVel" : 0,
									"yVel" : 0,
									"rad" : 10
								}];
								
		var circle;
		
		$(document).ready(function(){
			
			w = window.innerWidth;
			h = window.innerHeight;
			laser[0].xPos = window.innerWidth/2-10;
			laser[0].yPos = window.innerHeight/2-10;
			
			
			svg = d3.select("#body").append("svg:svg")
				.attr("width", w)
				.attr("height", h);
			
			circle = svg.selectAll("circle")
					.data(laser)
				.enter().append("svg:circle")
					.attr("r", function(d) { return d.rad; })
					.attr("cx", function(d) { return d.xPos; })
					.attr("cy", function(d) { return d.yPos; })
					.style("fill", "blue");
					
			window.addEventListener("devicemotion",onDeviceMotion,false);
			
			d3.timer(function(){
				laser[0].xPos += laser[0].xVel;
				if (laser[0].xPos < laser[0].rad){
					laser[0].xPos = laser[0].rad;
					laser[0].xVel = 0;
				}
				else if (laser[0].xPos > w - laser[0].rad){
					laser[0].xPos = w - laser[0].rad;
					laser[0].xVel = 0;
				}
				
				laser[0].yPos += laser[0].yVel;
				if (laser[0].yPos < laser[0].rad){
					laser[0].yPos = laser[0].rad;
					laser[0].yVel = 0;
				}
				else if (laser[0].yPos > h - laser[0].rad){
					laser[0].yPos = h - laser[0].rad;
					laser[0].yVel = 0;
				}
				
				circle.transition()
					.attr("cx", function(d) { return d.xPos; })
					.attr("cy", function(d) { return d.yPos; })
			});
			
		});
		
		
									 
		function onDeviceMotion(event){
			var accel = event.accelerationIncludingGravity;
			laser[0].xVel += accel.x * 100;
			laser[0].yVel -= accel.y * 100;
		}
	</script>
	
</head> 

<body>
	<div id="body"></div>
	
	
</body>

</html>
